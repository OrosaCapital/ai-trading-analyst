
LOVABLE INCIDENT FIX – FETCH_CHART_DATA 500 ERROR
================================================

PROBLEM
- fetch-chart-data Edge Function returns 500.
- Error: "Failed to fetch CoinGlass data for BTCUSD. Hobbyist plan requires valid 4h interval data."
- Root cause: CoinGlass Hobbyist plan does NOT support short intervals (1m/5m/1h). Must use 4h.
- UI shows blank chart.

IMMEDIATE FIXES
----------------
1) Validate COINGLASS_API_KEY in Supabase env.

2) Enforce allowed interval (4h only).
   File: supabase/functions/fetch-chart-data/index.ts
   Update all CoinGlass calls to:
   interval=4h

3) Redeploy:
   supabase functions deploy fetch-chart-data

4) Verify logs for successful data return.

MINIMAL CODE CHANGE
-------------------
Use:
const url = `${API_ENDPOINTS.coinglass}/...&symbol=BTC&interval=4h`;

LONG-TERM FIXES
----------------
1) Add interval fallback:
   try preferred interval → if plan error → fallback to 4h.

2) Add structured logging via:
   _shared/monitoring/logger.ts

3) Add retry + backoff wrapper:
   _shared/services/coinglassService.ts

4) Frontend graceful degradation:
   If 500, show:
   "Chart data limited by provider. Showing highest available interval."

LOVABLE ENFORCEMENT RULES
-------------------------
- Always request allowed intervals based on plan.
- Never call unsupported intervals.
- Use fallback interval if CoinGlass rejects request.
- Ensure no chart blank screens.

END
================================================
